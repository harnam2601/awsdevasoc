<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- Fontawesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Local CSS -->
    <style>
      .noteText{
        width: 100%;
        resize: none;
      }

      .hidden{
        display: none;
      }
    </style>

    <title>AWS Developer Associate</title>
  </head>
  <body>
    <div class="container mt-3 mb-3">
      <div class="row">
        <div class="col-md-4 d-flex justify-content-center mt-1 mb-1">
          <button type="button" class="btn btn-primary" id="addNew">Add New</button>
        </div>
        <div class="col-md-4 d-flex justify-content-center mt-1 mb-1">
          <button type="button" class="btn btn-primary" id="getRandom">Get Random</button>
        </div>
        <div class="col-md-4 d-flex justify-content-center mt-1 mb-1">
          <button type="button" class="btn btn-primary" id="viewAll">View All</button>
        </div>
      </div>
      <div class="row mt-3 mb-3 hidden" id="addNewRow">
        <div class="col">
          <label for="note" class="badge badge-info">Add New</label>
          <textarea name="note" id="note" class="noteText" cols="30" rows="15" ></textarea>
          <button type="button" class="btn btn-warning" id="saveNew">Save</button>
        </div>
      </div>
      <div class="row mt-3 mb-3" id="randomNoteRow">
        <div class="col">
          <label for="randomNote" class="badge badge-info">Random</label>
          <textarea name="randomNote" id="randomNote" class="noteText" cols="30" rows="15" readonly></textarea>
          <button type="button" class="btn btn-success" id="getRandomBtn">New</button>
          <button type="button" class="btn btn-success" id="speechPlayBtn"><i class="fa fa-play"></i></button>
          <button type="button" class="btn btn-success" id="speechStopBtn"><i class="fa fa-stop"></i></button>
        </div>
      </div>
      <div class="row mt-3 mb-3 hidden" id="allNotesRow">
        <div class="col">
          <label for="" class="badge badge-info">All Notes</label>
          <table class="table table-striped">
            <thead class="thead-dark">
              <tr>
                <th scope="col">#</th>
                <th scope="col">Note</th>
              </tr>
            </thead>
            <tbody id="viewAllNotesTable">
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <!-- Text to Speech JS -->
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=TONJntja"></script>

    <!-- Local JavaScript -->
    <script>

      jQuery.fn.clickToggle = function(a, b) {
        return this.on("click", function(ev) { [b, a][this.$_io ^= 1].call(this, ev) })
      };

      var data;
      var randomRecord = [];

      $(document).ready(()=>{

        $.ajax({
            method: "POST",
            url: "/backend.php",
            data: {
              action: "getAllNotes",
            },
            dataType: "json",
            success: (response)=>{
              if(typeof(response.success[0] == 'object' && response.success[0] != 'error' && response.success[0] != '0 results')){
                data = response.success[0];
                let randomNoteId = (Math.floor(Math.random() * data.length)+1);
                randomRecord.push(randomNoteId);
                $("#randomNote").val(data[randomNoteId-1].note);
              }
            }
          });

        $("#speechPlayBtn").on('click', (event) => {
            let text = $("#randomNote").val();
            if(responsiveVoice.isPlaying()) {
                responsiveVoice.resume();
            }
            else if(text){
                responsiveVoice.speak(text, "Australian Female");
            }
        });

        $("#speechStopBtn").on('click', (event) => {
            if(responsiveVoice.isPlaying()) {
                responsiveVoice.cancel();
            }
        });
        
        $("#addNew").on('click', (event)=>{
          $("#addNewRow").show();
          $("#randomNoteRow").hide();
          $("#allNotesRow").hide();
        });

        $("#getRandom").on('click', (event)=>{
          $("#addNewRow").hide();
          $("#randomNoteRow").show();
          $("#allNotesRow").hide();
        });

        $("#viewAll").on('click', (event)=>{
          $("#addNewRow").hide();
          $("#randomNoteRow").hide();
          $("#allNotesRow").show();

          $.ajax({
            method: "POST",
            url: "/backend.php",
            data: {
              action: "getAllNotes",
            },
            dataType: "json",
            success: (response)=>{
              if(response.success[0] == "error"){
                $("#viewAllNotesTable").html("Error retrieving results");
              }
              else if(response.success[0] == "0 results"){
                $("#viewAllNotesTable").html("No Data");
              }
              else{
                let tableData = "";
                response.success[0].forEach((value, index) => {
                  tableData = tableData + `
                  <tr>
                    <th scope="row">${value.id}</th>
                    <td>${value.note}</td>
                  </tr>
                  `;
                });
                $("#viewAllNotesTable").html(tableData);
              }
            }
          });
        });

        $("#saveNew").on("click", (event) =>{
          $.ajax({
            method: "POST",
            url: "/backend.php",
            data: {
              action: "saveNewNote",
              newNoteContent: $("#note").val()
            },
            dataType: "json",
            success: (response)=>{
              $("#note").val(''); 
              if(response.success[0] == "One row inserted"){
                $("#saveNew").removeClass("btn-warning");
                $("#saveNew").addClass("btn-success");
                setTimeout(()=>{
                  $("#saveNew").removeClass("btn-success");
                  $("#saveNew").addClass("btn-warning"); 
                }, 1000);
              }
              else{
                $("#saveNew").removeClass("btn-warning");
                $("#saveNew").addClass("btn-danger");
                setTimeout(()=>{
                  $("#saveNew").removeClass("btn-danger");
                  $("#saveNew").addClass("btn-warning");
                }, 1000);
              }
            }
          });
        });

        $("#getRandomBtn").on("click", (event) =>{

          let randomNoteId = (Math.floor(Math.random() * data.length)+1);

          if(randomRecord.length == data.length){
            randomRecord = [];
          }

          while(randomRecord.indexOf(randomNoteId) != -1){
            randomNoteId = (Math.floor(Math.random() * data.length)+1);
          }

          randomRecord.push(randomNoteId);
          $("#randomNote").val(data[randomNoteId-1].note);
        });

      });
      
    </script>
  </body>
</html>
